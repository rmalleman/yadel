import org.roylance.yaclib.YaclibPlugin
import org.roylance.yaclib.YaclibModel

group 'org.roylance.yadel'
version = "${actualMajor}.${actualMinor}"

apply plugin: 'java'


buildscript {
    repositories {
        jcenter()
        mavenCentral()
        maven { url repoUrl_ }
    }
    dependencies {
        classpath "org.roylance.yaclib:core:${yaclibMajor}.${yaclibMinor}"
        classpath "org.roylance.yadel:api:${actualMajor}.${actualMinor}"
    }
}

task execute(type: YaclibPlugin) {
    def parentDir = new File(System.getProperty("user.dir")).parentFile.toString()

    typeScriptModelFile = "YadelModel"
    majorVersion = actualMajor.toInteger()
    minorVersion = actualMinor.toInteger()
    location = parentDir
    mainModel = "org.roylance.yadel.YadelReport"
    mainController = "org.roylance.yadel.YadelController"

    dependencyDescriptors = new ArrayList<>()
    thirdPartyServerDependencies = new ArrayList<>()
    repositoryType = YaclibModel.RepositoryType.BINTRAY

    def akkaDependency = YaclibModel.Dependency.newBuilder().setType(YaclibModel.DependencyType.JAVA)
            .setGroup("com.typesafe.akka")
            .setName("akka-cluster_2.11")
            .setThirdPartyDependencyVersion("2.4.7")
            .build()

    thirdPartyServerDependencies.add(akkaDependency)

    nugetKey = System.getenv('NUGET_KEY')

    githubRepo = githubRepo_
    repoUrl = repoUrl_
    repoUser = ""
    repoName = repoName_
    license = license_
    author = author_

    println(nugetKey)
    println(parentDir)
}